<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>팀 랜덤 생성기</title>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

        <style>
            /* General body and container styles */
            body {
                font-family: "Montserrat", sans-serif;
                background-color: #f0f4ff; /* Softer background color */
                max-width: 800px; /* Wider max width */
                margin: 0 auto;
                padding: 20px;
            }
            .container {
                background-color: #ffffff; /* White background for the main container */
                border-radius: 15px;
                padding: 20px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); /* Softer shadow */
                transition: box-shadow 0.3s; /* Transition for shadow on hover */
            }
            .container:hover {
                box-shadow: 0 6px 30px rgba(0, 0, 0, 0.2); /* Enhanced shadow on hover */
            }
            h1 {
                text-align: center;
                color: #333; /* Darker text color */
            }
            input,
            button {
                margin: 10px 5px; /* Increased margin for better spacing */
                padding: 10px; /* Increased padding */
                font-size: 16px; /* Larger font size */
                border: 1px solid #ccc;
                border-radius: 5px;
                outline: none; /* Remove outline on focus */
                transition: border-color 0.3s; /* Transition for border color */
            }
            input:focus {
                border-color: #5cb85c; /* Highlight border on focus */
            }
            button {
                cursor: pointer;
                background-color: #5cb85c; /* Green button color */
                color: white;
                transition: background-color 0.3s; /* Smooth transition */
                border: none; /* No border */
            }
            button:hover {
                background-color: #4cae4c; /* Darker green on hover */
            }

            /* List and card styles */
            .name-list {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px; /* Increased gap between cards */
                padding: 0;
                list-style-type: none;
            }
            .card {
                background-color: #f9f9f9;
                padding: 15px;
                border: 1px solid #ddd;
                border-radius: 10px;
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
                transition: transform 0.3s, box-shadow 0.3s; /* Smooth hover effects */
                position: relative; /* Position for button */
            }
            .card:hover {
                transform: translateY(-2px); /* Lift effect on hover */
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* Enhanced shadow on hover */
            }
            .card img {
                width: 80px; /* Slightly larger image */
                height: 80px; /* Slightly larger image */
                border-radius: 50%;
                margin-bottom: 10px;
            }
            .card span {
                font-size: 18px; /* Slightly larger font size for names */
                font-weight: bold; /* Bold names for better emphasis */
                color: #333; /* Darker text for names */
                cursor: pointer; /* Pointer cursor for editable names */
            }
            .delete-btn {
                margin-top: 10px;
                background-color: #ff4d4d; /* Red button color */
                border: none;
                border-radius: 5px;
                cursor: pointer;
                padding: 8px 12px; /* Adjusted padding */
                font-size: 14px; /* Font size */
                transition: background-color 0.3s; /* Smooth transition */
            }
            .delete-btn:hover {
                background-color: #e63946; /* Darker red on hover */
            }

            /* Teams output style */
            #teamsOutput {
                margin-top: 20px;
            }
            .team {
                background-color: #e0e0ff;
                border-radius: 10px;
                padding: 15px;
                margin-bottom: 10px;
                border: 1px solid #b0b0e0; /* Slight border for teams */
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Light shadow for teams */
                opacity: 0; /* Start hidden */
                transform: translateY(20px); /* Start 20px down */
                animation: slideUp 0.5s forwards; /* Animation for slide up */
                position: relative; /* For delete button positioning */
            }
            @keyframes slideUp {
                to {
                    opacity: 1; /* Fully visible */
                    transform: translateY(0); /* Move to original position */
                }
            }
            .team strong {
                font-size: 18px; /* Increased font size for team labels */
                color: #333; /* Darker text for teams */
            }
            .team .delete-team-btn {
                position: absolute;
                top: 10px;
                right: 10px;
                background-color: #ff4d4d; /* Red button color */
                border: none;
                border-radius: 5px;
                cursor: pointer;
                padding: 5px 10px; /* Adjusted padding */
                font-size: 12px; /* Font size */
                transition: background-color 0.3s; /* Smooth transition */
            }
            .team .delete-team-btn:hover {
                background-color: #e63946; /* Darker red on hover */
            }

            /* Teams output style 수정 */
            #teamsOutput {
                margin-top: 20px;
                display: flex;
                flex-wrap: wrap;
                gap: 20px;
                justify-content: center;
            }
            .team {
                background-color: #e0e0ff;
                border-radius: 10px;
                padding: 15px;
                border: 1px solid #b0b0e0;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                opacity: 0;
                transform: translateY(20px);
                animation: slideUp 0.5s forwards;
                position: relative;
                width: 200px; /* 팀 카드의 너비 설정 */
            }
            @keyframes slideUp {
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            .team strong {
                font-size: 18px;
                color: #333;
                display: block;
                margin-bottom: 10px;
            }
            .team .delete-team-btn {
                position: absolute;
                top: 10px;
                right: 10px;
                background-color: #ff4d4d;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                padding: 5px 10px;
                font-size: 12px;
                transition: background-color 0.3s;
            }
            .team .delete-team-btn:hover {
                background-color: #e63946;
            }
            .team .card {
                margin-bottom: 10px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>팀 랜덤 생성기</h1>
            <div>
                <input type="text" id="nameInput" placeholder="이름 입력" />
                <input type="file" id="avatarInput" accept="image/*" />
                <button onclick="addName()">추가</button>
            </div>

            <h3>참가자 목록:</h3>
            <ul id="nameList" class="name-list"></ul>

            <div>
                <label for="membersPerTeamInput">팀당 인원 수:</label>
                <input
                    type="number"
                    id="membersPerTeamInput"
                    value="3"
                    min="1"
                />
                <button onclick="generateTeams()">팀 생성</button>
                <button onclick="clearAllNames()">전체 삭제</button>
                <button onclick="downloadTeams()">팀 다운로드</button>
            </div>

            <!-- Teams output still in the same container -->
            <div id="teamsOutput"></div>
        </div>

        <script>
            let names = JSON.parse(localStorage.getItem("names")) || [];

            function addName() {
                const nameInput = document.getElementById("nameInput");
                const avatarInput = document.getElementById("avatarInput");
                const name = nameInput.value.trim();

                const avatarUrl = avatarInput.files[0]
                    ? URL.createObjectURL(avatarInput.files[0])
                    : "https://via.placeholder.com/80"; // Updated placeholder size

                if (name !== "") {
                    names.push({ name, avatar: avatarUrl });
                    nameInput.value = "";
                    avatarInput.value = "";
                    updateNameList();
                    saveNamesToLocalStorage();
                }
            }

            function updateNameList() {
                const nameList = document.getElementById("nameList");
                nameList.innerHTML = "";
                names.forEach((person, index) => {
                    const li = document.createElement("li");
                    const card = document.createElement("div");
                    card.className = "card";

                    const img = document.createElement("img");
                    img.src = person.avatar;
                    img.onclick = () => changeAvatar(index);

                    const nameText = document.createElement("span");
                    nameText.textContent = person.name;
                    nameText.onclick = () => editName(index); // Enable editing on click

                    const deleteButton = document.createElement("button");
                    deleteButton.textContent = "삭제";
                    deleteButton.className = "delete-btn";
                    deleteButton.onclick = () => removeName(index);

                    card.appendChild(img);
                    card.appendChild(nameText);
                    card.appendChild(deleteButton);
                    li.appendChild(card);
                    nameList.appendChild(li);
                });
            }

            function removeName(index) {
                names.splice(index, 1);
                updateNameList();
                saveNamesToLocalStorage();
            }

            function changeAvatar(index) {
                const fileInput = document.createElement("input");
                fileInput.type = "file";
                fileInput.accept = "image/*";
                fileInput.onchange = (event) => {
                    const newAvatar = URL.createObjectURL(
                        event.target.files[0]
                    );
                    names[index].avatar = newAvatar;
                    updateNameList();
                    saveNamesToLocalStorage();
                };
                fileInput.click();
            }

            function editName(index) {
                const newName = prompt("새 이름 입력:", names[index].name);
                if (newName !== null && newName.trim() !== "") {
                    names[index].name = newName.trim();
                    updateNameList();
                    saveNamesToLocalStorage();
                }
            }

            function generateTeams() {
                const membersPerTeam = parseInt(
                    document.getElementById("membersPerTeamInput").value
                );
                const teamsOutput = document.getElementById("teamsOutput");
                teamsOutput.innerHTML = ""; // Clear previous output

                const shuffledNames = names.sort(() => Math.random() - 0.5);
                const teams = [];
                while (shuffledNames.length) {
                    teams.push(shuffledNames.splice(0, membersPerTeam));
                }

                teams.forEach((team, index) => {
                    const teamDiv = document.createElement("div");
                    teamDiv.className = "team";

                    const teamLabel = document.createElement("strong");
                    teamLabel.textContent = `팀 ${index + 1}:`;

                    const deleteTeamButton = document.createElement("button");
                    deleteTeamButton.textContent = "팀 삭제";
                    deleteTeamButton.className = "delete-team-btn";
                    deleteTeamButton.onclick = () => {
                        teamDiv.remove();
                    };

                    teamDiv.appendChild(teamLabel);
                    teamDiv.appendChild(deleteTeamButton);

                    team.forEach((member) => {
                        const memberCard = document.createElement("div");
                        memberCard.className = "card";

                        const memberImg = document.createElement("img");
                        memberImg.src = member.avatar;
                        memberImg.style.width = "60px"; // 팀 내 멤버 이미지 크기 조정
                        memberImg.style.height = "60px";

                        const memberName = document.createElement("span");
                        memberName.textContent = member.name;

                        memberCard.appendChild(memberImg);
                        memberCard.appendChild(memberName);
                        teamDiv.appendChild(memberCard);
                    });

                    teamsOutput.appendChild(teamDiv);
                });

                // Apply animation to the teams
                teamsOutput.childNodes.forEach((teamDiv, index) => {
                    setTimeout(() => {
                        teamDiv.style.opacity = 1;
                        teamDiv.style.transform = "translateY(0)";
                    }, index * 100);
                });
            }

            function clearAllNames() {
                names = [];
                updateNameList();
                saveNamesToLocalStorage();
            }

            function saveNamesToLocalStorage() {
                localStorage.setItem("names", JSON.stringify(names));
            }

            function downloadTeams() {
                const teamsOutput = document.getElementById("teamsOutput");

                // Use html2canvas to capture the element as an image
                html2canvas(teamsOutput, { scale: 2 }) // Increased scale for better quality
                    .then((canvas) => {
                        // Convert canvas to JPG data URL
                        const dataURL = canvas.toDataURL("image/jpeg", 0.9); // Increased quality to 0.9

                        // Create a link element
                        const link = document.createElement("a");
                        link.href = dataURL;
                        link.download = "teams.jpg";

                        // Append link to body, click it, and remove it
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    })
                    .catch((error) => {
                        console.error("Error in downloadTeams:", error);
                        alert(
                            "팀 이미지 다운로드 중 오류가 발생했습니다. 다시 시도해 주세요."
                        );
                    });
            }
            // Initialize the name list on page load
            window.onload = updateNameList;
        </script>
    </body>
</html>
